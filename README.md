# stamp_testtask

Тестовое задание. Текст [здесь](https://disk.yandex.ru/i/QmG9dTkX0jlQhA).

## Пояснения

* Для выполнения задания была выбрана модель `YOLOv8n`. Она быстрая, легко экспортируется и обладает приемлемой точностью. Вся информация [здесь](https://docs.ultralytics.com/models/yolov8/). 
* Инференс построен на рантайме ONNX. ONNX был выбран для демонстрации навыков работы с разными экспортируемыми форматами. 
* Для исключения случайного обнаружения автомобилей на прилегающей дороге был добавлен Region Of Interest (ROI), координаты которого находятся в `config.yaml`.
* В `config.yaml` указан белый лист (WHITE_LIST) классов. 
* Для демонстрации результата обнаружения транспортных средств был создан автомат состояний (`barrier_state.py`), который наносится на каждый кадр: 
    1. `VEHICLE_WAITING`, если ТС есть в ROI.
    2. `VEHICLE_APPROACHING`, если ТС обнаружен, но недостаточно долго.
    3. `NO_VEHICLE`, если ТС нет в ROI.  
* В `config.yaml` присутствует параметр `show`. Если `true`, включается демонстрация обработанных кадров через `cv2.imshow`. Если `false`, то производится запись кадров в файл. 

## Установка зависимостей и запуск

1. Проект работает с UV. Если не установлен, ссылка на инструкцию [тут](https://docs.astral.sh/uv/getting-started/installation/).

2. Установить зависимости и нужную версию Python можно командой:
    ```bash
    uv sync
    ```

3. Перед первым запуском необходимо экспортировать модель:
    ```bash
    # По умолчанию скачивается модель YOLOv8n по пути "model/yolov8n.pt" и экспортируется как ONNX
    # Экспортированная модель будет сохранена в "model/yolov8n.onnx"

    uv run export.py 

    # Можно выбрать свой путь с помощью аргумента
    uv run export.py --model path/to/yolov8n.pt

    # Тогда экспортированная модель будет сохранена в "path/to/yolov8n.onnx"
    ```

4. Аргументы для запуска детектора находятся в конфигурационном файле `config.yaml`:
    ```yaml
    video_path: "cvtest.avi"          # Путь к видеофайлу
    model_path: "model/yolov8n.onnx"  # Путь к ONNX модели
    show: true                        # Показать видео с детекцией. Если false, то производим запись в файл output_path
    output_path: "result/result.avi"  # Путь к выходному видеофайлу
    ```
    Запуск:
    ```bash
    uv run detector.py
    ```